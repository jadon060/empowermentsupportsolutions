<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ESS • Omar – Person-Centered Plan (PCP)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --brand:#2c3e50;
      --brand-2:#0f4c81;
      --bg:#f3f4f6;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --radius:16px;
      --shadow:0 8px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font:16px/1.6 system-ui,-apple-system,"Segoe UI",sans-serif;
    }
    header{
      background:var(--brand);
      color:#fff;
      padding:20px;
      text-align:center;
    }
    header img{
      height:70px;
      margin-bottom:10px;
    }
    .wrap{
      max-width:900px;
      margin:20px auto;
      padding:0 14px;
    }
    h2{
      margin-top:30px;
      color:var(--brand-2);
      font-size:22px;
      font-weight:700;
    }
    h3{
      color:var(--brand);
      margin-top:20px;
      font-size:18px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px 20px;
      margin-bottom:22px;
      box-shadow:var(--shadow);
    }
    label{
      font-size:14px;
      font-weight:600;
      color:var(--ink);
      display:block;
      margin-bottom:4px;
    }
    textarea{
      width:100%;
      min-height:80px;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      font-size:14px;
      resize:vertical;
    }
    .sig-row{
      display:flex;
      gap:30px;
      margin-top:20px;
    }
    .sig-box{
      flex:1;
      background:#fff;
      border:1px dashed #bbb;
      border-radius:12px;
      padding:10px;
    }
    .sig-label{
      font-weight:600;
      margin-bottom:6px;
    }
    canvas{
      width:100%;
      height:180px;
      border:1px solid #ccc;
      border-radius:12px;
      background:#fff;
      touch-action:none;
    }
    button{
      background:var(--brand);
      border:none;
      border-radius:12px;
      padding:14px 20px;
      color:#fff;
      font-size:16px;
      cursor:pointer;
      display:block;
      width:100%;
      margin-top:30px;
    }
    .clear-btn{
      background:#e5e7eb;
      color:#111827;
      padding:8px 14px;
      border-radius:10px;
      font-size:14px;
      cursor:pointer;
      margin-top:10px;
      border:none;
    }
    footer{
      text-align:center;
      padding:20px;
      font-size:13px;
      color:#6b7280;
    }
  </style>
</head>

<body>

<header>
  <img src="https://raw.githubusercontent.com/jadon060/empowermentsupportsolutions/main/logo%20full.png" alt="ESS Logo">
  <div style="font-size:22px;font-weight:700;">Empowerment Support Solutions, LLC</div>
  <div style="font-size:15px;opacity:.9;margin-top:6px;">Person-Centered Plan (PCP) for Omar</div>
  <div id="todayDate" style="font-size:13px;margin-top:4px;"></div>
</header>

<div class="wrap">

  <!-- SECTION I -->
  <h2>Section I — Personal Profile</h2>
  <div class="card">
    <label>What people like & admire about Omar</label>
    <textarea id="like_admire"></textarea>

    <label>Omar’s strengths</label>
    <textarea id="strengths"></textarea>

    <label>Important TO Omar</label>
    <textarea id="important_to"></textarea>

    <label>Important FOR Omar</label>
    <textarea id="important_for"></textarea>

    <label>Communication style</label>
    <textarea id="communication"></textarea>

    <label>Sensory needs</label>
    <textarea id="sensory"></textarea>

    <label>Behavioral & emotional considerations</label>
    <textarea id="behavioral"></textarea>

    <label>Health & safety considerations</label>
    <textarea id="health_safety"></textarea>

    <label>Cultural or personal identity notes</label>
    <textarea id="cultural"></textarea>
  </div>

  <!-- SECTION II -->
  <h2>Section II — Daily Routines & Life</h2>
  <div class="card">
    <label>Morning routine</label>
    <textarea id="morning"></textarea>

    <label>Afternoon routine</label>
    <textarea id="afternoon"></textarea>

    <label>Evening routine</label>
    <textarea id="evening"></textarea>

    <label>Community routines</label>
    <textarea id="community"></textarea>

    <label>What helps Omar during stress</label>
    <textarea id="stress_help"></textarea>

    <label>Known triggers</label>
    <textarea id="triggers"></textarea>
  </div>

  <!-- SECTION III -->
  <h2>Section III — Individual Outcomes</h2>

  <div class="card">
    <h3>Outcome 1 — Community Engagement</h3>
    <label>Goal</label><textarea id="outcome1_goal"></textarea>
    <label>Why this matters</label><textarea id="outcome1_why"></textarea>
    <label>Current barriers</label><textarea id="outcome1_barriers"></textarea>
    <label>Teaching & support strategies</label><textarea id="outcome1_strategies"></textarea>
    <label>Progress measurement</label><textarea id="outcome1_measure"></textarea>
    <label>ESS Staff responsibilities (John Doe)</label><textarea id="outcome1_staff"></textarea>
    <label>Timeline / expected progress</label><textarea id="outcome1_timeline"></textarea>
  </div>

  <div class="card">
    <h3>Outcome 2 — Independent Living Skills</h3>
    <label>Goal</label><textarea id="outcome2_goal"></textarea>
    <label>Why this matters</label><textarea id="outcome2_why"></textarea>
    <label>Current barriers</label><textarea id="outcome2_barriers"></textarea>
    <label>Teaching & support strategies</label><textarea id="outcome2_strategies"></textarea>
    <label>Progress measurement</label><textarea id="outcome2_measure"></textarea>
    <label>ESS Staff responsibilities (John Doe)</label><textarea id="outcome2_staff"></textarea>
    <label>Timeline / expected progress</label><textarea id="outcome2_timeline"></textarea>
  </div>

  <div class="card">
    <h3>Outcome 3 — Health & Safety</h3>
    <label>Goal</label><textarea id="outcome3_goal"></textarea>
    <label>Why this matters</label><textarea id="outcome3_why"></textarea>
    <label>Current barriers</label><textarea id="outcome3_barriers"></textarea>
    <label>Teaching & support strategies</label><textarea id="outcome3_strategies"></textarea>
    <label>Progress measurement</label><textarea id="outcome3_measure"></textarea>
    <label>ESS Staff responsibilities (John Doe)</label><textarea id="outcome3_staff"></textarea>
    <label>Timeline / expected progress</label><textarea id="outcome3_timeline"></textarea>
  </div>

  <div class="card">
    <h3>Outcome 4 — Behavioral / Emotional Regulation</h3>
    <label>Goal</label><textarea id="outcome4_goal"></textarea>
    <label>Why this matters</label><textarea id="outcome4_why"></textarea>
    <label>Current barriers</label><textarea id="outcome4_barriers"></textarea>
    <label>Teaching & support strategies</label><textarea id="outcome4_strategies"></textarea>
    <label>Progress measurement</label><textarea id="outcome4_measure"></textarea>
    <label>ESS Staff responsibilities (John Doe)</label><textarea id="outcome4_staff"></textarea>
    <label>Timeline / expected progress</label><textarea id="outcome4_timeline"></textarea>
  </div>

  <div class="card">
    <h3>Outcome 5 — Communication & Self-Advocacy</h3>
    <label>Goal</label><textarea id="outcome5_goal"></textarea>
    <label>Why this matters</label><textarea id="outcome5_why"></textarea>
    <label>Current barriers</label><textarea id="outcome5_barriers"></textarea>
    <label>Teaching & support strategies</label><textarea id="outcome5_strategies"></textarea>
    <label>Progress measurement</label><textarea id="outcome5_measure"></textarea>
    <label>ESS Staff responsibilities (John Doe)</label><textarea id="outcome5_staff"></textarea>
    <label>Timeline / expected progress</label><textarea id="outcome5_timeline"></textarea>
  </div>

  <!-- SECTION IV -->
  <h2>Section IV — Natural & Paid Supports</h2>
  <div class="card">
    <label>Natural supports (e.g., John Doe)</label>
    <textarea id="natural_supports"></textarea>

    <label>Paid supports (ESS Staff)</label>
    <textarea id="paid_supports"></textarea>

    <label>Justification for paid supports</label>
    <textarea id="justification"></textarea>

    <label>Hours needed per month</label>
    <textarea id="hours_needed"></textarea>
  </div>

  <!-- SECTION V -->
  <h2>Section V — Risk & Mitigation</h2>
  <div class="card">
    <label>Behavioral risks</label><textarea id="risk_behavior"></textarea>
    <label>Medical risks</label><textarea id="risk_medical"></textarea>
    <label>Environmental risks</label><textarea id="risk_env"></textarea>
    <label>Community risks</label><textarea id="risk_comm"></textarea>
    <label>Crisis plan</label><textarea id="crisis_plan"></textarea>
    <label>Mitigation strategies</label><textarea id="mitigation"></textarea>
  </div>

  <!-- SECTION VI -->
  <h2>Section VI — Future Vision</h2>
  <div class="card">
    <label>Omar’s preferred future</label><textarea id="future_pref"></textarea>
    <label>Goals for independence</label><textarea id="future_goals"></textarea>
    <label>Community involvement</label><textarea id="future_comm"></textarea>
    <label>Long-term direction</label><textarea id="future_long"></textarea>
  </div>

  <!-- SIGNATURES -->
  <h2>Signatures</h2>
  <div class="card">
    <div class="sig-row">
      <!-- Omar -->
      <div class="sig-box">
        <div class="sig-label">Omar Signature</div>
        <canvas id="sig_omar"></canvas>
        <button class="clear-btn" id="clearOmar">Clear</button>
      </div>

      <!-- Staff -->
      <div class="sig-box">
        <div class="sig-label">ESS Staff Signature (John Doe)</div>
        <canvas id="sig_staff"></canvas>
        <button class="clear-btn" id="clearStaff">Clear</button>
      </div>
    </div>
  </div>

  <!-- SUBMIT PCP -->
  <button id="submitPCP">Submit PCP</button>

</div>

<footer>
  Empowerment Support Solutions, LLC — Person-Centered Planning (SDP Compliant)
</footer>

<!-- JS will be added in MESSAGE 2 -->
<script>
document.getElementById("todayDate").textContent =
  "Date: " + new Date().toLocaleDateString();
</script>

</body>
</html>
<!-- ========================= -->
<!--  MESSAGE 2 — FULL JS CODE -->
<!-- ========================= -->
<script type="module">
  // --------------------------------------------
  // 1. CONNECT TO SUPABASE
  // --------------------------------------------
  const SUPABASE_URL = "YOUR_SUPABASE_URL_HERE";
  const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY_HERE";

  const { createClient } = supabase;
  const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // Omar's client_id (loaded from Supabase)
  const CLIENT_ID = "521dd725-2fa6-4d78-9fcc-e5447dc727cb";

  // --------------------------------------------
  // 2. SIGNATURE CANVAS SETUP (TWO AREAS)
  // --------------------------------------------
  function setupSignatureCanvas(id, clearBtnId) {
    const canvas = document.getElementById(id);
    const ctx = canvas.getContext("2d");

    let drawing = false;
    let rect = canvas.getBoundingClientRect();

    function start(e) {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(
        (e.touches ? e.touches[0].clientX : e.clientX) - rect.left,
        (e.touches ? e.touches[0].clientY : e.clientY) - rect.top
      );
    }

    function move(e) {
      if (!drawing) return;
      ctx.lineTo(
        (e.touches ? e.touches[0].clientX : e.clientX) - rect.left,
        (e.touches ? e.touches[0].clientY : e.clientY) - rect.top
      );
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    function end() {
      drawing = false;
    }

    // Desktop events
    canvas.addEventListener("mousedown", start);
    canvas.addEventListener("mousemove", move);
    canvas.addEventListener("mouseup", end);
    canvas.addEventListener("mouseleave", end);

    // Mobile events
    canvas.addEventListener("touchstart", start);
    canvas.addEventListener("touchmove", move);
    canvas.addEventListener("touchend", end);

    // Fix sizing when resizing
    window.addEventListener("resize", () => {
      rect = canvas.getBoundingClientRect();
    });

    // Clear button
    document.getElementById(clearBtnId).addEventListener("click", () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    return canvas;
  }

  const canvasOmar = setupSignatureCanvas("sig_omar", "clearOmar");
  const canvasStaff = setupSignatureCanvas("sig_staff", "clearStaff");

  // --------------------------------------------
  // 3. COLLECT ALL FORM DATA INTO JSON
  // --------------------------------------------
  function collectPCPData() {
    const fields = [
      "like_admire","strengths","important_to","important_for","communication","sensory",
      "behavioral","health_safety","cultural","morning","afternoon","evening","community",
      "stress_help","triggers","outcome1_goal","outcome1_why","outcome1_barriers",
      "outcome1_strategies","outcome1_measure","outcome1_staff","outcome1_timeline",
      "outcome2_goal","outcome2_why","outcome2_barriers","outcome2_strategies",
      "outcome2_measure","outcome2_staff","outcome2_timeline","outcome3_goal",
      "outcome3_why","outcome3_barriers","outcome3_strategies","outcome3_measure",
      "outcome3_staff","outcome3_timeline","outcome4_goal","outcome4_why",
      "outcome4_barriers","outcome4_strategies","outcome4_measure","outcome4_staff",
      "outcome4_timeline","outcome5_goal","outcome5_why","outcome5_barriers",
      "outcome5_strategies","outcome5_measure","outcome5_staff","outcome5_timeline",
      "natural_supports","paid_supports","justification","hours_needed","risk_behavior",
      "risk_medical","risk_env","risk_comm","crisis_plan","mitigation",
      "future_pref","future_goals","future_comm","future_long"
    ];

    let data = {};
    fields.forEach(f => {
      data[f] = document.getElementById(f).value.trim();
    });

    return data;
  }

  // --------------------------------------------
  // 4. CONVERT SIGNATURE CANVAS → BASE64
  // --------------------------------------------
  function getSignatureBase64(canvas) {
    return canvas.toDataURL("image/png");
  }

  // --------------------------------------------
  // 5. SUBMIT PCP FORM
  // --------------------------------------------
  document.getElementById("submitPCP").addEventListener("click", async () => {
    try {
      // Disable button to prevent double submissions
      const btn = document.getElementById("submitPCP");
      btn.disabled = true;
      btn.textContent = "Submitting…";

      // Collect data
      const pcpData = collectPCPData();
      const sigOmar = getSignatureBase64(canvasOmar);
      const sigStaff = getSignatureBase64(canvasStaff);

      // Build record
      const record = {
        client_id: CLIENT_ID,
        pcp_data: pcpData,
        signature_base64: JSON.stringify({
          omar_signature: sigOmar,
          staff_signature: sigStaff
        })
      };

      // Insert into Supabase
      const { data, error } = await db.from("ess.pcp_entries").insert(record);

      if (error) {
        console.error(error);
        alert("Error saving PCP. Please try again.");
        btn.disabled = false;
        btn.textContent = "Submit PCP";
        return;
      }

      // Success
      alert("PCP successfully submitted.");
      btn.textContent = "Submitted ✔";
      btn.disabled = true;

    } catch (err) {
      console.error(err);
      alert("Unexpected error.");
      const btn = document.getElementById("submitPCP");
      btn.disabled = false;
      btn.textContent = "Submit PCP";
    }
  });

</script>

<!-- Supabase JS CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
