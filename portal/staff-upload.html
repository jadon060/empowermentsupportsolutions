<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ESS ‚Ä¢ Staff Upload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --brand:#1f2e3d; --accent:#0ea5e9;
      --bg:#f5f7fb; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb;
      --radius-xl:20px; --shadow-md:0 8px 25px rgba(2,12,27,.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background:var(--bg);
    }

    /* Topbar */
    .topbar{
      display:flex; align-items:center; gap:12px;
      padding:16px 20px; background:#fff;
      border-bottom:1px solid #e5e7eb;
      box-shadow:0 2px 8px rgba(0,0,0,.04);
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:700; color:var(--brand)}
    .brand img{height:26px}
    .right{margin-left:auto}
    .btn-ghost{
      appearance:none; border:0; background:var(--brand); color:#fff;
      padding:10px 14px; border-radius:10px; font-weight:700; text-decoration:none;
    }
    .btn-ghost:hover{filter:brightness(1.1)}

    /* Layout */
    .wrap{max-width:900px; margin:24px auto 80px; padding:0 16px}

    /* Banner (smaller + gradient like portal) */
    .banner{
      background:linear-gradient(135deg,#e0f2fe 0%,#f0fdf4 100%);
      border:1px solid #dbeafe;
      border-radius:var(--radius-xl);
      padding:18px 24px;
      box-shadow:var(--shadow-md);
      display:flex; flex-direction:column; gap:4px;
    }
    .banner h1{margin:0; font-size:1.4rem; color:var(--brand); font-weight:800;}
    .banner p{margin:0; color:var(--muted); font-size:0.95rem;}

    .card{
      margin-top:20px; background:var(--card); border:1px solid var(--line);
      border-radius:var(--radius-xl); box-shadow:var(--shadow-md); padding:26px;
    }
    label{display:block; font-weight:600; margin:10px 0 8px}
    .input{
      width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:14px;
      background:#fff; outline:none; font:inherit;
    }
    .input:focus{border-color:#93c5fd; box-shadow:0 0 0 3px rgba(59,130,246,.1)}
    .row{margin:14px 0}
    .hint{color:var(--muted); font-size:.92rem}

    .btn{
      appearance:none; border:0; cursor:pointer;
      display:inline-flex; align-items:center; justify-content:center;
      padding:14px 22px; border-radius:12px; font-weight:800; font-size:1rem;
      color:#fff; background:var(--brand);
      box-shadow:0 6px 14px rgba(31,46,61,.15);
    }
    .btn:hover{filter:brightness(1.05)}
    .progress{height:8px; background:#e5e7eb; border-radius:999px; overflow:hidden; margin-top:16px}
    .bar{height:100%; width:0%; background:linear-gradient(90deg, var(--accent), #60a5fa)}
    pre{white-space:pre-wrap}

    /* Toast */
    .toast {
      position: fixed; bottom: 28px; right: 28px;
      background: var(--brand); color: #fff;
      padding: 14px 22px; border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0,0,0,.15);
      opacity: 0; pointer-events: none;
      transform: translateY(20px);
      transition: all 0.35s ease;
      font-weight: 600; z-index: 99;
    }
    .toast.show {opacity: 1; transform: translateY(0);}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <img src="/logo%20full.png" alt="ESS" />
      <span>ESS ‚Ä¢ Staff Upload</span>
    </div>
    <div class="right"><a class="btn-ghost" href="/staff.html">‚Üê Return to Portal</a></div>
  </div>

  <div class="wrap">
    <!-- Small banner like the portal -->
    <div class="banner">
      <h1>üìÅ Upload Staff Documents</h1>
      <p>Securely submit CPR/First Aid, ID, TB, timesheets, and more.</p>
    </div>

    <div class="card">
      <div class="row">
        <label for="name">Staff Name</label>
        <input id="name" class="input" type="text" placeholder="First Last">
      </div>
      <div class="row">
        <label for="doctype">Document Type</label>
        <input id="doctype" class="input" type="text" placeholder="CPR, TB, ID, Timesheet‚Ä¶">
      </div>
      <div class="row">
        <label for="file">Files</label>
        <input id="file" class="input" type="file" multiple accept=".pdf,.jpg,.jpeg,.png,.heic,.webp">
        <div class="hint">Tip: you can select multiple files at once.</div>
      </div>
      <button id="upload" class="btn">Upload</button>

      <div class="progress"><div class="bar" id="bar"></div></div>
      <pre id="out" class="hint" style="margin-top:10px"></pre>
    </div>
  </div>

  <div id="toast" class="toast">‚úÖ Upload successful!</div>

  <script>
    const SUPABASE_URL = "https://bqanjupmcgydvmfgvutx.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxYW5qdXBtY2d5ZHZtZmd2dXR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MTI4NzQsImV4cCI6MjA3NjM4ODg3NH0.J3A12rwUlSqjIsmlnNCcwis6Qt_ryw7ZzFqLftuMKUk";
    const BUCKET = "ess-staff-uploads";
    const PREFIX = "inbox";

    async function uploadOne(file, key){
      const url = `${SUPABASE_URL}/storage/v1/object/${BUCKET}/${encodeURIComponent(key)}`;
      const res = await fetch(url, {
        method: "POST",
        headers: {
          "apikey": SUPABASE_ANON_KEY,
          "Authorization": `Bearer ${SUPABASE_ANON_KEY}`,
          "x-upsert": "false"
        },
        body: file
      });
      if (!res.ok) throw new Error(`HTTP ${res.status}: ${await res.text()}`);
      return res.json();
    }

    const btn = document.getElementById('upload');
    const bar = document.getElementById('bar');
    const out = document.getElementById('out');
    const toast = document.getElementById('toast');

    function showToast(msg){
      toast.textContent = "‚úÖ " + msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 3000);
    }

    btn.onclick = async () => {
      try{
        const files = document.getElementById('file').files;
        const name = (document.getElementById('name').value || 'anon').trim().replace(/[^\w\- ]+/g,'').replace(/\s+/g,'_');
        const doctype = (document.getElementById('doctype').value || 'doc').trim().replace(/[^\w\- ]+/g,'').replace(/\s+/g,'_');
        if (!files.length){ out.textContent = "Pick at least one file."; return; }

        btn.disabled = true; out.textContent = "Uploading‚Ä¶"; bar.style.width = '5%';

        let done = 0;
        for (const f of files){
          if (f.size > 25 * 1024 * 1024) throw new Error(`File too large: ${f.name}`);
          const stamp = new Date().toISOString().replace(/[:.]/g,'');
          const key = `${PREFIX}/${name}_${doctype}_${stamp}_${f.name}`;
          await uploadOne(f, key);
          done++;
          bar.style.width = `${Math.round(done/files.length*100)}%`;
        }

        out.textContent = `Uploaded ${done} file(s) successfully. ‚úÖ`;
        showToast("Upload successful!");
      }catch(err){
        out.textContent = `Upload failed: ${err.message}`;
      }finally{
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>
