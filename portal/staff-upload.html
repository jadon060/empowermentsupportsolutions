<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ESS • Staff Document Upload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --brand:#2c3e50; --bg:#f6f8fc; --card:#fff;
      --ink:#1f2937; --muted:#64748b; --line:#e5e7eb;
      --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--ink)}
    header{display:flex;align-items:center;gap:10px;padding:14px 16px;background:#fff;box-shadow:0 2px 12px rgba(0,0,0,.06)}
    header img{height:32px;}
    header strong{font-size:1rem;}
    header a{margin-left:auto;background:var(--brand);color:#fff;text-decoration:none;padding:8px 12px;border-radius:10px;font-weight:600;font-size:0.9rem;transition:background .2s}
    header a:hover{background:#1b2a38;}
    @media (max-width:600px){header{flex-wrap:wrap;justify-content:space-between;padding:10px 14px;} header strong{flex:1 1 100%;font-size:0.95rem;margin-top:4px;} header a{padding:6px 10px;font-size:0.85rem;border-radius:8px;}}
    main{max-width:900px;margin:32px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:22px}
    h1{margin:0 0 8px;color:var(--brand)} 
    p.lead{margin:0;color:var(--muted)}
    .hint{color:var(--muted);font-size:.92rem}
    .row{margin:12px 0}
    input,button{font:inherit}
    input[type="text"]{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px}
    .btn{display:inline-block;background:var(--brand);color:#fff;padding:12px 16px;border-radius:12px;font-weight:700;text-decoration:none;cursor:pointer;border:0}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .progress{height:8px;background:#e5e7eb;border-radius:6px;overflow:hidden;margin-top:8px}
    .bar{height:100%;width:0%}
    pre{white-space:pre-wrap}
  </style>
</head>
<body>
  <header>
    <img src="/logo%20full.png" alt="ESS" />
    <strong>Empowerment Support Solutions • Staff Upload</strong>
    <a href="/staff.html">← Return to Portal</a>
  </header>

  <main>
    <div class="card">
      <h1>Upload Staff Documents</h1>
      <p class="lead">Securely submit CPR/First Aid, ID, TB, timesheets, and more.</p>

      <div class="row">
        <label>Staff Name<br><input id="name" type="text" placeholder="First Last"></label>
      </div>
      <div class="row">
        <label>Document Type<br><input id="doctype" type="text" placeholder="CPR, TB, ID, Timesheet..."></label>
      </div>
      <div class="row">
        <input id="file" type="file" multiple>
      </div>
      <button id="upload" class="btn">Upload</button>
      <div class="progress"><div class="bar" id="bar"></div></div>
      <pre id="out" class="hint" style="margin-top:10px"></pre>
    </div>
  </main>

  <script>
    // === Supabase config (filled in) ===
    const SUPABASE_URL = "https://bqanjupmcgydvmfgvutx.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxYW5qdXBtY2d5ZHZtZmd2dXR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MTI4NzQsImV4cCI6MjA3NjM4ODg3NH0.J3A12rwUlSqjIsmlnNCcwis6Qt_ryw7ZzFqLftuMKUk";
    const BUCKET = "ess-staff-uploads";   // private bucket you created
    const PREFIX = "inbox";                // insert-only folder per policy

    async function uploadOne(file, key){
      const url = `${SUPABASE_URL}/storage/v1/object/${BUCKET}/${encodeURIComponent(key)}`;
      const res = await fetch(url, {
        method: "POST", // create a new object
        headers: {
          "apikey": SUPABASE_ANON_KEY,
          "Authorization": `Bearer ${SUPABASE_ANON_KEY}`,
          "x-upsert": "false" // change to "true" if you want to overwrite same filenames
        },
        body: file
      });
      if (!res.ok) throw new Error(`HTTP ${res.status}: ${await res.text()}`);
      return res.json();
    }

    const btn = document.getElementById('upload');
    const bar = document.getElementById('bar');
    const out = document.getElementById('out');

    btn.onclick = async () => {
      try{
        const files = document.getElementById('file').files;
        const name = (document.getElementById('name').value || 'anon').trim().replace(/[^\w\- ]+/g,'').replace(/\s+/g,'_');
        const doctype = (document.getElementById('doctype').value || 'doc').trim().replace(/[^\w\- ]+/g,'').replace(/\s+/g,'_');
        if (!files.length){ out.textContent = "Pick at least one file."; return; }

        btn.disabled = true; out.textContent = "Uploading..."; bar.style.width = '5%';

        let done = 0;
        for (const f of files){
          const stamp = new Date().toISOString().replace(/[:.]/g,'');
          const key = `${PREFIX}/${name}_${doctype}_${stamp}_${f.name}`;
          await uploadOne(f, key);
          done++;
          bar.style.width = `${Math.round(done / files.length * 100)}%`;
        }
        out.textContent = `Uploaded ${done} file(s) to secure inbox. ✅`;
      }catch(err){
        out.textContent = `Upload failed: ${err.message}`;
      }finally{
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>
